% ===========================================================================
% PREAMBLE STANDARD (English)
% ===========================================================================
% BABEL: L10n
%   Debian Buster babel 3.27
%   See: /usr/share/doc/texlive-doc/latex/babel/babel.pdf
%   Latest: 3.46
%   http://vesta.informatik.rwth-aachen.de/ftp/pub/mirror/ctan/macros/latex/required/babel/base/babel.pdf
%   Remark: hyperref package has a different language setup
%     \usepackage[pdflang=es-MX]{hyperref}
\include{JLANG}% includes command \jlanguage (ngerman, english)
\usepackage[main=\jlang,japanese]{babel}

% Use as:      \jhatsuon{がな}
% Will print:  【がな】
\newcommand{\jhatsuon}[1]{【#1】}
% INDEX - need to load before hyperref 2022-06-24
%\usepackage{makeidx}
%\usepackage{multind}%            more the one index (style makeindex)
\usepackage{imakeidx}% replace multind, need to be place fore tkiz
%\usepackage{showidx}
%\makeindex{japanese}
%\makeindex{english}
%\makeindex{german}
\makeindex[intoc=false,options=-s ../share/makeindex/english.ist,name=english,title=English: Terms,columns=2]
\makeindex[intoc=false,options=-s ../share/makeindex/japanese.ist,name=japanese,title=Japanese: Index,columns=3]
\makeindex[intoc=false,options=-s ../share/makeindex/german.ist,name=german,title=Deutsch: Fachbegriffe,columns=2]
\newcommand{\ien}[1]{\index[english]{#1}}
\newcommand{\ija}[1]{\index[japanese]{#1}}
\newcommand{\ide}[1]{\index[german]{#1}}
\newcommand{\ithree}[3]{\ien{#1}\ija{#2}\ide{#3}}
\newcommand{\ifor}[4]{\ien{#1}\ija{#2}\ija{#3}\ide{#4}}
\newcommand{\ivoc}[4]{\ifor{#1}{#2}{#3}{#4}\textbf{#1} {#2} {\jhatsuon{#3}}}
% ===========================================================================
\usepackage{fontspec}%           provides font selecting commands
\usepackage{xunicode}%           provides unicode character macros
\usepackage{xltxtra} %           provides some fixes/extras
%\usepackage[utf8x]{inputenc} %  problems with xetex?
%\usepackage[utf8]{inputenc} %   problems with xetex?
%\usepackage[T1]{fontenc} %      problems with xetex and UF8?
\usepackage{tabularx}%           order matters
\usepackage{tikz}%               order matters
%\usepackage{pgf-pie} %          order matters
\usepackage{wallpaper} %         order matters
\usepackage{tabu} %              make thick lines
\usepackage{colortbl} %          make color lines
\usepackage[]{graphicx}
\usepackage{xcolor}
\usepackage{hyperref}%   configured later!
\usepackage{fullpage,longtable}% better tables
\usepackage{hhline}%             better tables
\setlength{\parindent}{0cm}
\setlength{\arrayrulewidth}{2pt}
% ===========================================================================
% SET FONTS
%\usepackage{pifont}
%\usepackage{helvet}
\usepackage{latexsym}
\usepackage{amssymb,amsmath}

%\setmainfont{Ume Mincho S3}    % Serif      2 OK
%\setmainfont{AR PL UMing HK}   % Typewriter 1 GOOD
%\setmainfont{Sawarabi Gothic}   % SanSerif   1 GOOD
%\setmainfont{WenQuanYi Zen Hei}% SanSerif   2 OK (wrong g?)
%\setmainfont{Komatuna P}       % SanSerif   3 MAMA (but strong!)

% Should be LMRoman12 though
%\setmainfont[Mapping=tex-text]{LMRoman10}
%\setsansfont{AR PL UMing HK}
%\setmonofont{AR PL UMing HK}

%\setmainfont{IPAPMincho}
%\setmonofont{IPAPGothic}
%\setsansfont{IPAPMincho}
%\setmainfont{IPAPMincho}
%\setmonofont{IPAMincho}
%\setsansfont{IPAPMincho}

%\fontspec[
%ItalicFont={IPAGothic},
%BoldFont={IPAGothic},
%ItalicFeatures={FakeSlant},
%BoldFeatures={FakeBold=1.5},
%]{IPAPMincho}

%BoldFont = URW Palladio L,
%ItalicFont = URW Palladio L,
%BoldItalicFont = URW Palladio L,
%SlantedFont = URW Palladio L,
%BoldSlantedFont = URW Palladio L,
%SmallCapsFont = URW Palladio L,
%UprightFont = *-Roman
%\setmainfont{YOzFontE}   % SanSerif   1 GOOD
%\setmonofont{AR PL UMing HK}

% ------  2014-09-06 -----
%\defaultfontfeatures{Ligatures=TeX}
%\setmainfont[SlantedFont={LMRoman10},
%             SlantedFeatures={FakeSlant=0.2}]{LMRoman10}
%\setsansfont[SlantedFont={LMRoman10},
%             SlantedFeatures={FakeSlant=0.2}]{LMRoman10}
\addtokomafont{footnote}{\footnotesize\sffamily}

\usepackage{array}% for vertical alignment in tabular with m{SIZE}
\usepackage{xeCJK}
\usepackage{ruby}
\renewcommand{\rubysep}{0.25ex}
\setCJKmainfont{IPAPMincho}

% 2014
%\setCJKfamilyfont{JapaneseYOzFont}{YOzFont90} %hand
%\setCJKfamilyfont{JapaneseYOzFontA}{YOzFontA}
%\setCJKfamilyfont{JapaneseYOzFontC}{YOzFontC90}
%\setCJKfamilyfont{JapaneseYOzFontE}{YOzFontE90}
%\setCJKfamilyfont{JapaneseYOzFontF}{YOzFontF90}
%\setCJKfamilyfont{JapaneseYOzFontM}{YOzFontN90}
%\setCJKfamilyfont{JapaneseYOzFontP}{YOzFontP90}

% 2019
\setCJKfamilyfont{JapaneseFontA}{YOzAb}
\setCJKfamilyfont{JapaneseFontB}{YOzC90b}
\setCJKfamilyfont{JapaneseFontC}{YOzE90b}
\setCJKfamilyfont{JapaneseFontD}{AoyagiSosekiFont2}
\setCJKfamilyfont{JapaneseFontE}{IPAGothic}
\setCJKfamilyfont{JapaneseFontF}{IPAMincho}
\setCJKfamilyfont{JapaneseFontG}{KanjiStrokeOrders}
\setCJKfamilyfont{JapaneseFontH}{kiloji - B}
\setCJKfamilyfont{JapaneseFontI}{KouzanBrushFontGyousyo}
\setCJKfamilyfont{JapaneseFontJ}{MotoyaLMaru}
\setCJKfamilyfont{JapaneseFontK}{SetoFont}
\setCJKfamilyfont{JapaneseFontL}{TakaoMincho}
\setCJKfamilyfont{JapaneseFontM}{VL Gothic}
\setCJKfamilyfont{JapaneseFontN}{HanaMinA} % For some Hentaiagana

\setCJKfamilyfont{JapaneseDejima}{Dejima}
\setCJKfamilyfont{JapaneseIPAPGothic}{IPAPGothic}
\setCJKfamilyfont{JapaneseDefault}{IPAPMincho}
\setCJKfamilyfont{JapaneseMikachanPB}{mikachan-PB}

\newcommand\JapaneseFontA{\CJKfamily{JapaneseFontA}\CJKnospace}
\newcommand\JapaneseFontB{\CJKfamily{JapaneseFontB}\CJKnospace}
\newcommand\JapaneseFontC{\CJKfamily{JapaneseFontC}\CJKnospace}
\newcommand\JapaneseFontD{\CJKfamily{JapaneseFontD}\CJKnospace}
\newcommand\JapaneseFontE{\CJKfamily{JapaneseFontE}\CJKnospace}
\newcommand\JapaneseFontF{\CJKfamily{JapaneseFontF}\CJKnospace}
\newcommand\JapaneseFontG{\CJKfamily{JapaneseFontG}\CJKnospace}
\newcommand\JapaneseFontH{\CJKfamily{JapaneseFontH}\CJKnospace}
\newcommand\JapaneseFontI{\CJKfamily{JapaneseFontI}\CJKnospace}
\newcommand\JapaneseFontJ{\CJKfamily{JapaneseFontJ}\CJKnospace}
\newcommand\JapaneseFontK{\CJKfamily{JapaneseFontK}\CJKnospace}
\newcommand\JapaneseFontL{\CJKfamily{JapaneseFontL}\CJKnospace}
\newcommand\JapaneseFontM{\CJKfamily{JapaneseFontM}\CJKnospace}
\newcommand\JapaneseFontN{\CJKfamily{JapaneseFontN}\CJKnospace}

\newcommand\JapaneseDejima{\CJKfamily{JapaneseDejima}\CJKnospace}
\newcommand\JapaneseIPAPGothic{\CJKfamily{JapaneseIPAPGothic}\CJKnospace}
\newcommand\JapaneseDefault{\CJKfamily{JapaneseDefault}\CJKnospace}
\newcommand\JapaneseMikachanPB{\CJKfamily{JapaneseMikachanPB}\CJKnospace}

%\setCJKsansfont[]{}
%\setCJKmonofont[...]{...}

% Should be LMRoman12 though
%\newcommand{\Circ}[1]{\fontspec{Sawarabi Gothic}#1\setmainfont{LMRoman10}}

% ===========================================================================
% WRITE JAPANESE TEXT VERTICALLY
% derived from jltxdoc.cls and plext.dtx
%\usepackage{plext}
\def\tsample#1{%
%  \hbox to\linewidth\bgroup\vrule width.1pt\hss
  \hbox to 150mm \bgroup\vrule width.1pt\hss
    \vbox\bgroup\hrule height.1pt
      \vskip.5\baselineskip
%      \vbox to\linewidth\bgroup\tate\hsize=#1\relax\vss}
      \vbox to 150mm \bgroup\tate\hsize=#1\relax\vss}
\def\endtsample{%
      \vss\egroup
      \vskip.5\baselineskip
    \hrule height.1pt\egroup
  \hss\vrule width.1pt\egroup}

% ---------------------------------------------------------------------------
% ADD THIS PACKAGES INCASE latex AND NOT platex is used:
% \documentclass[titlepage,12pt,a4paper,german]{book}
% PAKETE
% Deutsche Umlaute etc.
% \usepackage{2up}
% \usepackage{natbib}
% \bibpunct[;]{(}{)}{;}{a}{,}{,}
% Sprache (nach natbib)
% \usepackage{babel}
% pakete aus deutscher distribution
% \usepackage{2up}


% ===========================================================================
% Better hypphenation - more space
\sloppy
\input{../share/hyphenation/hyphenation}

% ===========================================================================
% PAGELAYOUT
\usepackage{geometry}
\geometry{
  top=1in,            % <-- you want to adjust this 0.5
  inner=.8in,
  outer=.6in,
  bottom=1.5in,
  footskip=5ex,
  headheight=5ex,       % <-- and this 3
  headsep=5ex,          % <-- and this 2
}
% better head lines
\usepackage{fancyhdr}
\pagestyle{fancy}
%\fancyhead{30pt}
\setlength\headheight{25.5pt}


% ===========================================================================
% NEW DEFINITIONS FOR SYSTEM COMMANDS
\makeatletter
\renewcommand{\chaptermark}[1]{\markboth{\textsf{\scriptsize \thechapter.\ #1\normalsize}}{}}
\renewcommand{\sectionmark}[1]{\markright{\textsf{\scriptsize\thesection.\ #1\normalsize}}{}}
\makeatother

%\renewcommand{\chaptermark}[1]{%
%\markboth{\textsf{\scriptsize \thechapter.%
%\ \chaptername:\ #1\normalsize}}{}}
%\renewcommand{\sectionmark}[1]{%
%\markright{\textsf{\scriptsize\thesection.\ #1\normalsize}}{}}

% ===========================================================================
% SETTING OWN VALUES
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
%\setlength{\baselineskip}{0pt}
%\setlength{\parskip}{\smallskipamount}
%\setlength{\parindent}{0pt}

% ===========================================================================
% BETTER PLACING of fig and tab ENVIRONMENTS
\usepackage{flafter}

% ===========================================================================
\usepackage{pdfpages}
% ===========================================================================
% LINKS
\providecolor{myblue}{rgb}{0,0.49995,1}
\hypersetup{
  pdflang=en-US,
  colorlinks,
  citecolor=myblue,
  filecolor=myblue,
  linkcolor=myblue,
  urlcolor=myblue}
% ===========================================================================
% FOR BOXES
\usepackage{microtype}
% 2014 Wheezy: \usepackage[framemethod=TikZ]{mdframed}
\usepackage[framemethod=tikz]{mdframed}
\usepackage{tcolorbox}
\usepackage[tikz]{bclogo}
\usepackage{lipsum}

% ===========================================================================
% REVISION DATE VERSION
\include{JSTATE}

% ===========================================================================
% Japanese TOC jtoc
% It will not use the toclof counters. There is a bug that if one uses \part
% as a reference there will always be a dot added the \thejchapter, like
%   .1 　日本語の書き方
% therefore the usual counters are used: \thechapter \thesection
%
% This section defined 2 commands:
%
%     \jchap{STRING} - adds a toc entry for the chapter
%     \jsec{STRING}  - adds a toc entry for the chapter
%
\usepackage{tocloft}
\newlistof[part]{answer}{ans}{Table of Contents}

\newcommand{\listjtocname}{Japanese: Contents - 目次}
\newlistof[part]{jchapter}{jtoc}{\listjtocname}
% --- jchap
\newcommand{\jchap}[1]{%
\ifthenelse{\equal{0}{\thechapter}}{%
\addcontentsline{jtoc}{jchapter}{\protect\numberline{} #1}%
}{
\addcontentsline{jtoc}{jchapter}{\protect\numberline{\thechapter} #1}%
}}
\newcommand{\jindex}[1]{\addcontentsline{jtoc}{jchapter}{#1}}
% --- jsection
\newlistentry[chapter]{jsection}{jtoc}{1}
\newcommand{\jsec}[1]{%
\ifthenelse{\equal{0.0}{\thesection}}{%
\addcontentsline{jtoc}{jsection}{\protect\numberline{}#1}
}{
\addcontentsline{jtoc}{jsection}{\protect\numberline{\thesection}#1}
}
}
\newcommand{\jsubindex}[1]{\addcontentsline{jtoc}{jsection}{#1}}
%
\newlistentry[section]{jsubsection}{jtoc}{1}
\newcommand{\jsubsec}[1]{%
\addcontentsline{jtoc}{jsubsection}{\protect\numberline{\thesubsection}#1}
}

\makeatletter
\renewcommand{\@pnumwidth}{2em}
%\renewcommand*{\raggedchapterentry}{\setlength\@tempdima{2.3em}}
%\renewcommand*\l@section{\bprot@dottedtocline{1}{1.5em}{3.2em}}
\renewcommand*\cftchapnumwidth{2em}
\renewcommand*\cftsecnumwidth{3em}
\renewcommand*\cftjchapternumwidth{2em}
\renewcommand*\cftjsectionnumwidth{3em}
\renewcommand*\cftjsubsectionnumwidth{3em}
\makeatother
\setcounter{jtocdepth}{4}

% Used for index heading 2022-06-24
\usepackage{calc}
%\definecolor{indexcolor}{HTML}{F16723}
\definecolor{indexcolor}{HTML}{898989}

\usepackage{wrapfig}
\usepackage{float}% For H in \begin{figure}
%\floatstyle{boxed}
%\restylefloat{figure}

% ckuelker 2022-08-03
\usepackage{tablefootnote}

\ifthenelse{\equal{hiragana}{\jtopic}}{%
  \newcommand{\Jletter}[1]{\Hletter{#1}}
  \newcommand{\JLETTER}[1]{\HLETTER{#1}}
}{}
\ifthenelse{\equal{katakana}{\jtopic}}{%
  \newcommand{\Jletter}[1]{\Kletter{#1}}
  \newcommand{\JLETTER}[1]{\KLETTER{#1}}
}{}

% ckuelker 2022-08-08
\newcommand{\jvolumes}[1]{\raisebox{-.1\height}{\scalebox{1.2}{#1}}}

% ckuelker 2022-08-09

% --- \jtl
% Transliteration: ⟨...⟩
% Math mode
%\newcommand{\jtl}[1]{$\langle#1\rangle$}% Japanese Transliteration IPA
% DejaVuSans mode
%\newcommand{\jtl}[1]{\fontspec{DejaVuSans}⟨#1⟩\fontspec{FreeSans}}% Japanese Transliteration IPA
\usepackage{textcomp}
\newcommand{\jtl}[1]{\textlangle{}#1\textrangle{}}% Japanese Transliteration IPA
% --- \jphonemic
\newcommand{\jphonemic}[1]{/#1/}% Japanese phonemic /.../
% --- \jphonetic
\newcommand{\jphonetic}[1]{[#1]}% Japanese phonetic [...]

% Use as \jhiragana{}
\newcommand{\jhiragana}{\textbf{hiragana}}
\newcommand{\jHiragana}{\textbf{Hiragana}}
\newcommand{\jkatakana}{\textbf{katakana}}
\newcommand{\jKatakana}{\textbf{Katakana}}

\newcommand{\jhiraganaonly}[1]{\ifthenelse{\equal{hiragana}{\jtopic}}{#1}{}}
\newcommand{\jkatakanaonly}[1]{\ifthenelse{\equal{katakana}{\jtopic}}{#1}{}}

% 2022-09-09 

\ifthenelse{\equal{hiragana}{\jtopic}}{%
  \newcommand{\jkanaletteri}{い}
  \newcommand{\jkanalettershi}{し}
  \newcommand{\jkanavoc}{\ivoc{hiragana}{平仮名}{ひらがな}{Hiragana}}
  \newcommand{\jtopicopposite}{katakana}
}{}
\ifthenelse{\equal{katakana}{\jtopic}}{%
  \newcommand{\jkanaletteri}{イ}
  \newcommand{\jkanalettershi}{シ}
  \newcommand{\jkanavoc}{\ivoc{katakana}{片仮名}{かたかな}{Katakana}}
  \newcommand{\jtopicopposite}{hiragana}
}{}

\usetikzlibrary{matrix}

\newcommand{\jkatakanacount}{47}
\newcommand{\jhiraganacount}{46}
\newcommand{\jkanacount}{\ifthenelse{\equal{hiragana}{\jtopic}}{\jhiraganacount}{\jkatakanacount}}

% NEW j + p (path) + [page|chap|sec|para] + [|t|l(language|tl)]
\newcommand{\jppage}{../content/page}                  %      page
\newcommand{\jppagel}{../content/\jlang/page}          %lang  page
\newcommand{\jppagelt}{../content/\jlang/page/\jtopic} %lang  chapter topic
\newcommand{\jpchap }{../content/chap}                 %      chapter
\newcommand{\jpchapl}{../content/\jlang/chap}          %lang  chapter
\newcommand{\jpchaplt}{../content/\jlang/chap/\jtopic} %lang  chapter topic
\newcommand{\jpsec}{../content/sec}                    %      sections
\newcommand{\jpsecl}{../content/\jlang/sec}            %lang  sections
\newcommand{\jpseclt}{../content/\jlang/sec/\jtopic}   %lang  sections topic
\newcommand{\jpsubsec}{../content/subsec}              %      subsection
\newcommand{\jpsubsecl}{../content/\jlang/subsec}      %lang  subsection
\newcommand{\jppara}{../content/para}                  %      paragraphs
\newcommand{\jpparal}{../content/\jlang/para}          %lang  paragraphs
\newcommand{\jptab}{../content/tab}                    %      tables
\newcommand{\jptabl}{../content/\jlang/tab}            %lang  tables
\newcommand{\jpnote}{../content/note}                  %      notes
\newcommand{\jpnotel}{../content/\jlang/note}          %lang  notes

